name: ETF Monitor

on:
  schedule:
    # --- ZEITPLAN (UTC) ---
    # GitHub Server nutzen UTC-Zeit!
    # Aktuell (Winter): Deutschland = UTC + 1 Stunde
    # Im Sommer: Deutschland = UTC + 2 Stunden (dann verschiebt sich alles um 1h nach hinten)
    
    # Ausführung: Stündlich zur vollen Stunde (Minute 0)
    # Start: 07:00 UTC (= 08:00 DE Winterzeit)
    # Ende:  17:00 UTC (= 18:00 DE Winterzeit)
    # Tage:  Montag bis Freitag (1-5)
    - cron: '0 7-17 * * 1-5'

  # Erlaubt den manuellen Start per Klick (zum Testen)
  workflow_dispatch:

jobs:
  run-monitor:
    runs-on: ubuntu-latest

    steps:
      # 1. Code aus dem Repo holen
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Python 3.10 einrichten
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      # 3. Bibliotheken installieren (yfinance, requests, python-dotenv)
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      # 4. WICHTIG: Die portfolio.json aus dem GitHub Secret erstellen
      - name: Create Portfolio JSON
        run: |
          echo '${{ secrets.PORTFOLIO_JSON }}' > portfolio.json

      # 5. Das eigentliche Python-Skript starten
      - name: Run Monitor Script
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python main.py
